SETUP

	Setup semaphore to build source code from github.

	http://semaphoreci.com -- create a startup plan.

	Create new project, point it at your github repo...

	Set it up to drive from .semaphore/semaphore.yml file and everything should work

	-----------

	Go to your semaphoreci account and select "Settings"

	Under "Settings" go to "Secrets"

	Create a new secret called "google-cloud-platform"

	Set it to an env var secret:

		"COMPANY_NAME" = "(lowercase company name)"

	eg. COMPANY_NAME=mycompany

	-----------

	Create a google cloud project called "Storage"

	Create a bucket in this project called "[companyname]_network_next_dev_artifacts"

	Accept all defaults for the bucket create.

	-----------

	Now we have to give semaphoreci permission to upload artifacts to the google cloud storage bucket.

	Create a service account.

	Go to "Create a service account" in the "Storage" google cloud project under "IAM / Service Accounts".

	Create a service account called "semaphore".

	Copy the name of the service account and write it down somewhere, eg. semaphore@storage-394918.iam.gserviceaccount.com

	Create a new key for this service account of type JSON.

	This file will download to a location on your computer as a .json file

	-----------

	Go to your semaphoreci account and select "Settings"

	Under "Settings" go to "Secrets"

	Create a new secret called "google-cloud-platform"

	Set the secret to type configuration file: "/home/semaphore/gcp-service-account.json"

	Upload the JSON key file downloaded from google cloud previously for the service account you just created.

	-----------

	Go to the cloud storage bucket in google cloud

	Grant access to read and write to the google cloud bucket.

	Set "New principals" to the name of your service account.

	Set permissions to "Storage Object Admin".

	-----------

	Go to semaphore and trigger a build in the "dev" branch. Create the "dev" branch if necessary.

	Once the build succeeds, it should automatically run "Upload Artifacts" from the build.

	Verify that the artifacts upload correctly, and you can now see them in the google cloud bucket.

	-----------

	Create a cloud storage bucket called "[companyname]_network_next_sdk_config"

	Give the same permissions to the service account on this bucket, except uncheck "Enforce public access protection" on create.

	Then, modify this bucket so it has public read access.

		Grant to "allUsers" "Cloud Storage Viewer".

	Ignore the warnings, the files need to be publicly accessible.

	-----------

	Run the "Upload Config" job under the last successful semaphore run.

	Verify that it succeeds, and you can now see the config files in the bucket.

	Verify that you can download the config files via the public URL

	eg. open https://storage.googleapis.com/[companyname]_network_next_sdk_config/multiplay.txt in a browser and see that you can view the text file.

	-----------

	Create a cloud storage bucket called "[companyname]_network_next_relay_artifacts"

	Give the same permissions to the service account on this bucket. Do NOT give it public access.

	Run the "Upload Relay" job in semaphore and verify that it succeeds and the relay binary appears in the bucket.

	-----------
