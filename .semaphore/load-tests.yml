version: v1.0

name: Load Tests

agent:
  machine:
    type: e1-standard-8
    os_image: ubuntu2004

blocks:

  - name: "Build Functional Tests (backend)"
    dependencies: []
    task:

      agent:
        machine:
          type: e1-standard-8
          os_image: ubuntu2004

      prologue:
        commands:
            - cache restore golang
            - sudo apt-get install -y libsodium-dev
            - checkout
            - cp envs/local.env .env

      jobs:

        - name: "Load Test Map"
          commands:
            - ./run load-test-map

        - name: "Load Test Redis Portal"
          commands:
            - sudo apt-get install -y redis-server
            - ./run load-test-redis-portal

        - name: "Load Test Redis Pubsub"
          commands:
            - sudo apt-get install -y redis-server
            - ./run load-test-redis-pubsub

        - name: "Load Test Redis Streams"
          commands:
            - sudo apt-get install -y redis-server
            - ./run load-test-redis-streams

        - name: "Load Test Redis Optimize"
          commands:
            - sudo apt-get install -y redis-server
            - ./run load-test-optimize

        - name: "Load Test Route Matrix"
          commands:
            - ./run load-test-route-matrix

        - name: "Load Test Relay Manager"
          commands:
            - ./run load-test-relay-manager

        - name: "Load Test Crypto Box"
          commands:
            - ./run load-test-crypto-box

        - name: "Load Test Crypto Sign"
          commands:
            - ./run load-test-crypto-sign
