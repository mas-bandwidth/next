version: v1.0

name: Test

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:

  - name: "Build on Build Machine"
    dependencies: []
    task:
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu2004
      secrets:
        - name: build-machine-access
        - name: build-machine-known-hosts
      jobs:
        - name: build
          commands:
           - cat /home/semaphore/.ssh/id_rsa_build
           - chmod 600 /home/semaphore/.ssh/id_rsa_build
           - ssh-add /home/semaphore/.ssh/id_rsa_build
           - ssh -J glenn@34.67.51.93 build@thor -p 2222 'cd /mnt/c/build && ./build.sh'
