version: v1.0

name: Test

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:

  - name: "Build on Build Machine"
    dependencies: []
    task:
      agent:
        machine:
          type: e1-standard-2
          os_image: ubuntu2004
      secrets:
        - name: build-machine-access
      jobs:
        - name: build
          commands:
            - echo '34.67.51.93 ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBF2a+pMAfNl0GxX4JPSDDC5pSJzLYDobVq0nPwx3Qi1AUNmwq25JbmkW6ihK+l2xSHEbXYl0N372CkH2566qrow=
build ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKnnTGxW50AdvqxOPjQI2vLtLJ0y+DCUQS+UFiXle6AU' >> /home/semaphore/known_hosts
            - ssh -J glenn@34.67.51.93 build@thor -p 2222 'cd /mnt/c/build && ./build.sh'
