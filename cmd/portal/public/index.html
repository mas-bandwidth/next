<html>
    <head>
        <meta http-equiv='cache-control' content='no-cache'>
        <meta http-equiv='expires' content='0'>
        <meta http-equiv='pragma' content='no-cache'>

        <title>Portal</title>
        <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
        <link rel="stylesheet"
              href="https://use.fontawesome.com/releases/v5.7.0/css/all.css"
              integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ"
              crossorigin="anonymous">
        <link rel="stylesheet"
              href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
              integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
              crossorigin="anonymous">
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
        <link rel="stylesheet" href="./js/uPlot/uPlot.min.css">
        <!-- Include Choices CSS -->
        <link rel="stylesheet" href="./js/choices/styles/choices.min.css" />
        <style>
            .choices__list--multiple .choices__item {
                background-color: lightgray;
                border: 1px solid darkgray;
                color: black;
                border-radius: 5px;
            }
            .choices[data-type*="select-multiple"] .choices__button, .choices[data-type*="text"] .choices__button {
                border-left: 0px;
                color: black;
            }
            .choices__item .is-highlighted {
                background-color: lightgray;
                border: 1px solid darkgray;
                color: black;
            }
            .fill {
                width: 100%;
                height: 100%;
            }
            .dashboard-title {
                width: 95%;
            }
            .workspace {
                width: 100%;
                justify-content: center;
            }
            .map {
                height: 95%;
                max-height: 1000px;
            }
            .mapboxgl-canvas {
                height: 100%;
                width: 100%;
            }
            .mapboxgl-map {
                height: 100%;
                width: 100%;
            }
            #session-tool-map { position: absolute; top: 0; bottom: 0; width: 100%; }
            body {
                font-size: 0.875rem;
            }

            .feather {
                width: 16px;
                height: 16px;
                vertical-align: text-bottom;
            }

            .logo-container {
                width: 100%;
                height: 24px;
                margin: 0;
                padding: 0;
                display: flex;
                align-items: center;
                justify-content: left;
            }

            .logo-fit {
                max-height: 24px;
                max-width: 100%;
            }

            .fixed-width {
                font-family: monospace;
                font-size: 120%;
            }

            .hidden {
                display: none;
            }

            div.table-no-top-line th {
                border-top: none !important;
            }

            /*
            * Sidebar
            */

            .sidebar {
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                z-index: 100; /* Behind the navbar */
                padding: 48px 0 0; /* Height of navbar */
                box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.1);
            }

            .sidebar-sticky {
                position: relative;
                top: 0;
                height: calc(100vh - 48px);
                padding-top: 0.5rem;
                overflow-x: hidden;
                overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
            }

            @supports ((position: -webkit-sticky) or (position: sticky)) {
                .sidebar-sticky {
                    position: -webkit-sticky;
                    position: sticky;
                }
            }

            .sidebar .nav-link {
                font-weight: 500;
                color: #333;
            }

            .sidebar .nav-link .feather {
                margin-right: 4px;
                color: #999;
            }

            .sidebar .nav-link.active {
                color: #007bff;
            }

            .sidebar .nav-link:hover .feather,
            .sidebar .nav-link.active .feather {
                color: inherit;
            }

            .sidebar-heading {
                font-size: 0.75rem;
                text-transform: uppercase;
            }

            /*
            * Content
            */

            [role="main"] {
                padding-top: 48px; /* Space for fixed navbar */
            }

            /*
            * Navbar
            */

            .navbar-brand {
                padding-top: 0.75rem;
                padding-bottom: 0.75rem;
                font-size: 1rem;
                background-color: rgba(0, 0, 0, 0.25);
                box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.25);
            }

            .navbar .form-control {
                padding: 0.75rem 1rem;
                border-width: 0;
                border-radius: 0;
            }

            .form-control-dark {
                color: #fff;
                background-color: rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.1);
            }

            .form-control-dark:focus {
                border-color: transparent;
                box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.25);
            }

            .btn-group-xs > .btn,
            .btn-xs {
                padding: 0.25rem 0.4rem;
                font-size: 0.875rem;
                line-height: 0.5;
                border-radius: 0.2rem;
            }

            td.td-btn {
                padding-top: 0.15rem;
                padding-bottom: 0;
            }

            td.td-btn > a.btn-xs {
                padding-bottom: calc(0.25rem + 1px);
            }
        </style>
    </head>
    <body class="hidden" id="app">
        <div id="root">
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark p-0 shadow">
                <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="/">
                    <div class="logo-container">
                        <img class="logo-fit" src="logo.png">
                    </div>
                </a>
                <ul class="navbar-nav px-3 w-100 mr-auto">
                    <li class="nav-item text-nowrap ">
                        <a class="nav-link active" href="#" id="map-link" onclick="WorkspaceHandler.changePage('map')">
                            Map
                        </a>
                    </li>
                    <li class="nav-item text-nowrap">
                        <a class="nav-link" href="#" id="sessions-link" onclick="WorkspaceHandler.changePage('sessions')">
                            Sessions
                        </a>
                    </li>
                    <li class="nav-item text-nowrap">
                        <a class="nav-link" href="#" id="session-tool-link" onclick="WorkspaceHandler.changePage('session-tool')">
                            Session Tool
                        </a>
                    </li>
                    <li class="nav-item text-nowrap">
                        <a class="nav-link" href="#" id="user-tool-link" onclick="WorkspaceHandler.changePage('user-tool')">
                            User Tool
                        </a>
                    </li>
                    <li class="nav-item text-nowrap">
                        <a class="nav-link" href="#" id="settings-link" onclick="WorkspaceHandler.changePage('settings')">
                            Settings
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav px-3">
                    <li class="nav-item text-nowrap  ">
                        <a class="nav-link" href="#" onclick="loginClient.logout()">
                            Logout
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="container-fluid">
                <div class="row">
                    <main role="main" class="col-md-12 col-lg-12 px-4" id="map-workspace">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom" id="map-sessions-count">
                            <div id="map-spinner" v-if="!showCount">
                                <div class="spinner-border" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                            <h1 class="h2" id="workspace-title" v-if="showCount">
                                Map&nbsp;
                                <span class="badge badge-dark">
                                    {{ sessions.length }} Total Sessions
                                </span>&nbsp;
                                <span class="badge badge-success">
                                    {{ onNN.length }} on Network Next
                                </span>
                            </h1>
                            <div class="btn-toolbar mb-2 mb-md-0 flex-grow-1">
                                <div class="mr-auto"></div>
                                <div class="px-2">
                                    <select class="form-control">
                                        <option onclick="MapHandler.updateMap('WORLD')">
                                            World
                                        </option>
                                        <option onclick="MapHandler.updateMap('USA')">
                                            United States
                                        </option>
                                    </select>
                                </div>
                                <div class="px-2" v-if="false">
                                    <select class="form-control">
                                        <option value="everything">
                                            Everything
                                        </option>
                                        <option value="direct">
                                            Direct Only
                                        </option>
                                        <option value="next">
                                            Network Next Only
                                        </option>
                                    </select>
                                </div>
                                <div class="px-2" v-if="false">
                                    <select class="form-control">
                                        <option value="dashboard">
                                            Dashboard
                                        </option>
                                        <option value="website">
                                            Website
                                        </option>
                                    </select>
                                </div>
                                <div class="px-2" v-if="false">
                                    <select class="form-control">
                                        <option value="default">
                                            Default
                                        </option>
                                        <option value="fullscreen">
                                            Fullscreen
                                        </option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div style="width: 100%; height: calc(-160px + 100vh); border: 1px solid rgb(136, 136, 136); background-color: rgb(27, 27, 27);" id="map-container"></div>
                    </main>
                    <main role="main" class="col-md-12 col-lg-12 px-4 hidden" id="sessions-workspace">
                        <div id="sessions">
                            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                                <div class="spinner-border" role="status" id="sessions-spinner" v-if="!showCount">
                                    <span class="sr-only">Loading...</span>
                                </div>
                                <h1 class="h2" v-if="showCount">
                                    Sessions&nbsp;
                                    <span class="badge badge-dark">
                                        {{ allMapSessions.length }} Total Sessions
                                    </span>&nbsp;
                                    <span class="badge badge-success">
                                        {{ nnSessions.length }} on Network Next
                                    </span>
                                </h1>
                                <div class="btn-toolbar mb-2 mb-md-0 flex-grow-1 hidden">
                                    <div class="mr-auto"></div>
                                    <div class="px-2">
                                        <select class="form-control">
                                            <option value="rtt">
                                                Sort by RTT
                                            </option>
                                            <option value="packetLoss">
                                                Sort by Packet Loss
                                            </option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive table-no-top-line" v-if="showCount">
                                <table class="table table-sm table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>
                                                <span>

                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Session ID
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    User ID
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    ISP
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Datacenter
                                                </span>
                                            </th>
                                            <th class="text-right">
                                                <span>
                                                    Direct RTT
                                                </span>
                                            </th>
                                            <th class="text-right">
                                                <span>
                                                    Next RTT
                                                </span>
                                            </th>
                                            <th class="text-right">
                                                <span>
                                                    Improvement
                                                </span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(session, index) in sessions">
                                            <td>
                                                <i class="fas fa-circle fa-w-16 fa-fw text-success" v-if="session.on_network_next"></i>
                                                <i class="fas fa-circle fa-w-16 fa-fw text-primary" v-if="!session.on_network_next"></i>
                                            </td>
                                            <td>
                                                <a class="text-dark fixed-width" href="#" v-on:click="fetchSessionInfo(session.id)">
                                                    {{ session.id }}
                                                </a>
                                            </td>
                                            <td>
                                                <a class="text-dark fixed-width" href="#" v-on:click="fetchUserSessions(session.user_hash)">
                                                    {{ session.user_hash }}
                                                </a>
                                            </td>
                                            <td>
                                                {{ session.location.isp }}
                                            </td>
                                            <td>
                                                <span class="text-dark">
                                                    {{ session.datacenter }}
                                                </span>
                                            </td>
                                            <td class="text-right ">
                                                {{ parseFloat(session.direct_rtt).toFixed(2) }}
                                            </td>
                                            <td class="text-right ">
                                                {{ parseFloat(session.next_rtt).toFixed(2) }}
                                            </td>
                                            <td class="text-right ">
                                                <span class="text-success" v-if="session.delta_rtt > 5">
                                                    <b>
                                                        {{ parseFloat(session.delta_rtt).toFixed(2) }}
                                                    </b>
                                                </span>
                                                <span style="color: orange;" v-if="session.delta_rtt > 2">
                                                    <b>
                                                        {{ parseFloat(session.delta_rtt).toFixed(2) }}
                                                    </b>
                                                </span>
                                                <span class="text-danger" v-if="session.delta_rtt <= 2">
                                                    <b>
                                                        {{ parseFloat(session.delta_rtt).toFixed(2) }}
                                                    </b>
                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                    <main role="main" class="col-md-12 col-lg-12 px-4 hidden" id="session-tool-workspace">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">
                                Session Tool
                            </h1>
                            <div class="btn-toolbar mb-2 mb-md-0 flex-grow-1 hidden">
                                <div class="mr-auto"></div>
                            </div>
                        </div>
                        <form class="flow-stats-form" onsubmit="fetchSessionInfo()">
                            <div class="form-group">
                                <label for="session-id-input">
                                    Session ID
                                </label>
                                <div class="row">
                                    <div class="col">
                                        <input id="session-id-input" class="form-control" type="text" placeholder="Enter a Session ID to view statistics" value="">
                                    </div>
                                    <div class="col-auto">
                                        <button class="btn btn-primary" type="submit">
                                            View Stats
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="alert alert-info" role="alert" id="session-tool-alert">
                            Please enter a valid session ID to view its statistics. It should be a hexadecimal number (with leading zeros), or a decimal number.
                        </div>
                        <div class="alert alert-danger hidden" role="alert" id="session-tool-danger">
                            Failed to fetch session details
                        </div>
                        <div id="session-details">
                            <div v-if="showDetails">
                                <div class="row">
                                    <div class="col-12 col-lg-8">
                                        <div class="card mb-2">
                                            <div class="card-header">
                                                <strong>
                                                    Latency
                                                </strong>
                                                <div class="float-right">
                                                    <span class="mr-2" style="border-right: 2px dotted rgb(51, 51, 51); display: none;"></span>
                                                    <span style="color: blue;">
                                                        — Network Next
                                                    </span>
                                                    <span style="color: red;">
                                                        — Direct
                                                    </span>
                                                    <span style="color: forestgreen;">
                                                        — Prediction
                                                    </span>
                                                    <span></span>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div id="latency-chart-1" class="fill"></div>
                                            </div>
                                            <div class="card-body">
                                                <div id="latency-chart-2" class="fill"></div>
                                            </div>
                                        </div>
                                        <div class="card mb-2">
                                            <div class="card-header">
                                                <strong>
                                                    Jitter
                                                </strong>
                                                <div class="float-right">
                                                    <span class="mr-2" style="border-right: 2px dotted rgb(51, 51, 51); display: none;"></span>
                                                    <span style="color: blue;">
                                                        — Network Next
                                                    </span>
                                                    <span style="color: red;">
                                                        — Direct
                                                    </span>
                                                    <span style="color: forestgreen;">
                                                        — Prediction
                                                    </span>
                                                    <span></span>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div id="jitter-chart-1" class="fill"></div>
                                            </div>
                                            <div class="card-body">
                                                <div id="jitter-chart-2" class="fill"></div>
                                            </div>
                                        </div>
                                        <div class="card mb-2">
                                            <div class="card-header">
                                                <strong>
                                                    Packet Loss
                                                </strong>
                                                <div class="float-right">
                                                    <span class="mr-2" style="border-right: 2px dotted rgb(51, 51, 51); display: none;"></span>
                                                    <span style="color: blue;">
                                                        — Network Next
                                                    </span>
                                                    <span style="color: red;">
                                                        — Direct
                                                    </span>
                                                    <span style="color: forestgreen;">
                                                        — Prediction
                                                    </span>
                                                    <span></span>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div id="packet-loss-chart-1" class="fill">
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div id="packet-loss-chart-2" class="fill">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card mb-2">
                                            <div class="card-header">
                                                <strong>
                                                    Bandwidth
                                                </strong>
                                                <div class="float-right">
                                                    <span class="mr-2" style="border-right: 2px dotted rgb(51, 51, 51); display: none;"></span>
                                                    <span style="color: orange;">
                                                        — Actual Up
                                                    </span>
                                                    <span style="color: blue;">
                                                        — Actual Down
                                                    </span>
                                                    <span></span>
                                                </div>
                                                <div class="float-right">
                                                    <span id="traffic-up-legend"></span>
                                                    <span id="traffic-down-legend"></span>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div id="bandwidth-chart-1" class="fill">
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <div id="bandwidth-chart-2" class="fill">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-lg-4">
                                        <div class="card">
                                            <div class="card-img-top">
                                                <div id="session-tool-map" style="width: 100%; height: 20vh; margin: 0px; padding: 0px; position: relative;"></div>
                                            </div>
                                            <div class="card-body">
                                                <div class="card-text">
                                                    <dl>
                                                        <dt>
                                                            ISP
                                                        </dt>
                                                        <dd>
                                                            <em>
                                                                {{ meta.location.isp }}
                                                            </em>
                                                        </dd>
                                                        <div>
                                                            <dt>
                                                                User ID
                                                            </dt>
                                                            <dd>
                                                                <a class="text-dark">
                                                                    {{ meta.user_hash }}
                                                                </a>
                                                            </dd>
                                                        </div>
                                                        <dt>
                                                            Customer
                                                        </dt>
                                                        <dd>
                                                            (no such buyer)
                                                        </dd>
                                                        <dt>
                                                            SDK Version
                                                        </dt>
                                                        <dd>
                                                            {{ meta.sdk }}
                                                        </dd>
                                                        <dt>
                                                            Connection Type
                                                        </dt>
                                                        <dd>
                                                            {{ meta.connection }}
                                                        </dd>
                                                        <dt>
                                                            Nearby Relays
                                                        </dt>
                                                        <dd v-if="meta.nearby_relays == 0">
                                                            No Nearby Relays
                                                        </dd>
                                                        <table class="table table-sm mt-1" v-if="meta.nearby_relays.length > 0">
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 50%;">
                                                                        Name
                                                                    </th>
                                                                    <th style="width: 16.66%;">
                                                                        RTT
                                                                    </th>
                                                                    <th style="width: 16.66%;">
                                                                        Jitter
                                                                    </th>
                                                                    <th style="width: 16.66%;">
                                                                        Packet Loss
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr v-for="relay in meta.nearby_relays">
                                                                    <td>
                                                                        <a class="text-dark">{{ relay.name }}</a>&nbsp;
                                                                    </td>
                                                                    <td>
                                                                        {{ relay.client_stats.rtt }}
                                                                    </td>
                                                                    <td>
                                                                        {{ relay.client_stats.jitter }}
                                                                    </td>
                                                                    <td>
                                                                        {{ relay.client_stats.packet_loss }}
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        <dt>
                                                            Route
                                                        </dt>
                                                        <table class="table table-sm mt-1">
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 50%;">
                                                                        Name
                                                                    </th>
                                                                    <th style="width: 50%;">
                                                                        Role
                                                                    </th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    <td>
                                                                        {{ meta.client_addr }}
                                                                    </td>
                                                                    <td>
                                                                        <em>
                                                                            User (Player)
                                                                        </em>
                                                                    </td>
                                                                </tr>
                                                                <tr v-for="index in meta.hops" :key="index" scope="row">
                                                                    <td>
                                                                        Relay {{ index }}
                                                                    </td>
                                                                    <td>
                                                                        Hop {{ index }}
                                                                    </td>
                                                                </tr>
                                                                <tr>
                                                                    <td>
                                                                        {{ meta.server_addr}}
                                                                    </td>
                                                                    <td>
                                                                        <em>Destination Server</em>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </dl>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                    <main role="main" class="col-md-12 col-lg-12 px-4 hidden" id="user-tool-workspace">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">
                                User Tool
                            </h1>
                            <div class="btn-toolbar mb-2 mb-md-0 flex-grow-1 hidden">
                                <div class="mr-auto"></div>
                            </div>
                        </div>
                        <form class="flow-stats-form" onsubmit="fetchUserSessions()">
                            <div class="form-group">
                                <label for="user-hash-input">
                                    User ID
                                </label>
                                <div class="row">
                                    <div class="col">
                                        <input id="user-hash-input" class="form-control" type="text" placeholder="Enter a Session ID to view statistics" value="">
                                    </div>
                                    <div class="col-auto">
                                        <button class="btn btn-primary" type="submit">
                                            View Sessions
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="alert alert-info" role="alert" id="user-tool-alert">
                            Please enter a user ID to view their sessions.
                        </div>
                        <div class="alert alert-danger hidden" role="alert" id="user-tool-danger">
                            Failed to fetch user sessions
                        </div>
                        <div id="user-sessions">
                            <div class="table-responsive table-no-top-line">
                                <table class="table table-sm" v-if="showTable">
                                    <thead>
                                        <tr>
                                            <th>
                                                <span>
                                                    Session ID
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Platform
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Connection Type
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    ISP
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Datacenter
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Server Address
                                                </span>
                                            </th>
                                            <th>
                                                <span>
                                                    Started
                                                </span>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody v-if="sessions.length > 0">
                                        <tr v-for="session in sessions">
                                            <td>
                                                <a class="text-dark fixed-width" href="#" v-on:click="fetchSessionInfo(session.id)">
                                                    {{ session.id }}
                                                </a>
                                            </td>
                                            <td>
                                                {{ session.platform }}
                                            </td>
                                            <td>
                                                {{ session.connection }}
                                            </td>
                                            <td>
                                                {{ session.location.isp }}
                                            </td>
                                            <td>
                                                {{ session.datacenter }}
                                            </td>
                                            <td>
                                                {{ session.server_addr }}
                                            </td>
                                            <td>
                                                IMPLEMENT
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tbody v-if="sessions.length == 0">
                                        <tr>
                                            <td colspan="7" class="text-muted">
                                                There are no sessions belonging to this user.
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </main>
                    <main role="main" class="col-md-12 col-lg-12 px-4 hidden" id="settings-workspace">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">
                                Settings
                            </h1>
                            <div class="btn-toolbar mb-2 mb-md-0 flex-grow-1 hidden">
                                <div class="mr-auto"></div>
                            </div>
                        </div>
                        <div class="card" style="margin-bottom: 250px;">
                            <div class="card-header">
                                <ul class="nav nav-tabs card-header-tabs">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="accounts-link" href="#" onclick="WorkspaceHandler.changeAccountPage('accounts')">
                                            Users
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="config-link" href="#" onclick="WorkspaceHandler.changeAccountPage('config')">
                                            Game Configuration
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="card-body" id="settings-page">
                                <h5 class="card-title">
                                    Automatic sign-in
                                </h5>
                                <p class="card-text">
                                    Save time by allowing users with verified email addresses automatic access to your Network Next account.
                                </p>
                                <div id="auto-sign-in-spinner" v-if="!showAccounts">
                                    <div class="spinner-border" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </div>
                                <form onsubmit="saveAutoSignIn(event)" v-if="showAccounts">
                                    <div class="form-group">
                                        <label for="customerId">
                                            Automatic Sign-in Domain
                                        </label>
                                        <input type="text" class="form-control form-control-sm" value="networknext.com" id="auto-sign-in-domain">
                                        <small class="form-text text-muted">
                                            If you set this to a domain, such as "example.com", then anyone with a verified email address with this domain will automatically join your account when logging in. You can set this so that you don't need to manually onboard everyone in your organization.
                                        </small>
                                    </div>
                                    <div class="form-group">
                                        <label for="customerId">
                                            Permission Level
                                        </label>
                                        <select
                                            class="form-control"
                                            id="auto-signin-permissions"
                                            multiple
                                        >
                                        </select>
                                        <small class="form-text text-muted">
                                            The permission level to grant accounts that join your account via automatic sign-in.
                                        </small>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-sm">
                                        Save Automatic Sign-in
                                    </button>
                                    <p class="text-muted text-small mt-2"></p>
                                </form>
                                <hr class="mt-4 mb-4">
                                <h5 class="card-title">
                                    Add new users
                                </h5>
                                <p class="card-text">
                                    Provide other people with access to your account.
                                </p>
                                <div id="add-user-spinner" v-if="!showAccounts">
                                    <div class="spinner-border" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </div>
                                <div class="alert alert-success" role="alert" id="session-tool-alert" v-if="newUser.success.message != ''">
                                    {{ newUser.success.message }}
                                </div>
                                <div class="alert alert-danger" role="alert" id="session-tool-alert" v-if="newUser.failure.message != ''">
                                    {{ newUser.failure.message }}
                                </div>
                                <form onsubmit="addUsers(event)" v-if="showAccounts">
                                    <div class="form-group">
                                        <label for="customerId">
                                            Add users by email address
                                        </label>
                                        <textarea class="form-control form-control-sm" id="new-user-emails"></textarea>
                                        <small class="form-text text-muted">
                                            Enter a newline or comma-delimited list of email addresses to add users to your account.
                                        </small>
                                    </div>
                                    <div class="form-group">
                                        <label for="customerId">
                                            Permission Level
                                        </label>
                                        <select
                                            class="form-control"
                                            id="add-user-permissions"
                                            placeholder="Select..."
                                            multiple
                                        >
                                        </select>
                                        <small class="form-text text-muted">
                                            The permission level to grant the added user accounts.
                                        </small>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-sm">
                                        Add Users
                                    </button>
                                    <p class="text-muted text-small mt-2"></p>
                                </form>
                                <hr class="mt-4 mb-4">
                                <h5 class="card-title">
                                    Manage existing users
                                </h5>
                                <p class="card-text">
                                    Manage the list of users that currently have access to your Network Next account.
                                </p>
                                <div id="account-table-spinner" v-if="!showAccounts">
                                    <div class="spinner-border" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                </div>
                                <table class="table table-sm mt-4" v-if="showAccounts">
                                    <thead class="thead-light">
                                        <tr>
                                            <th style="width: 20%;">
                                                Email Address
                                            </th>
                                            <th style="width: 70%;">
                                                Permissions
                                            </th>
                                            <th style="width: 10%;">
                                                Actions
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="(account, index) in accounts">
                                            <div
                                                class="alert alert-success"
                                                role="alert"
                                                v-if="updateUser.success.message != ''"
                                            >
                                                {{ updateUser.success.message }}
                                            </div>
                                            <div
                                                class="alert alert-danger"
                                                role="alert"
                                                v-if="updateUser.failure.message != ''"
                                            >
                                                {{ updateUser.failure.message }}
                                            </div>
                                            <td>
                                                {{ account.email }}
                                            </td>
                                            <td>
                                                <select
                                                    class="form-control"
                                                    :id="`edit-user-permissions-${account.user_id}`"
                                                    multiple
                                                >
                                                </select>
                                            </td>
                                            <td class="td-btn" v-if="!account.edit && !account.delete">
                                                <button
                                                    class="btn btn-xs btn-primary"
                                                    data-toggle="tooltip"
                                                    data-placement="bottom"
                                                    title="Change this user's permissions"
                                                    v-on:click="editUser(account, index)"
                                                >
                                                    <i class="fas fa-pen fa-w-16 fa-fw"></i>
                                                </button>&nbsp;
                                                <button
                                                    class="btn btn-xs btn-danger"
                                                    data-toggle="tooltip"
                                                    data-placement="bottom"
                                                    title="Remove this user"
                                                    v-on:click="deleteUser(index)"
                                                >
                                                    <i class="fas fa-trash fa-w-14 fa-fw"></i>
                                                </button>&nbsp;
                                            </td>
                                            <td class="td-btn" v-if="account.edit || account.delete">
                                                <button
                                                    class="btn btn-xs btn-success"
                                                    data-toggle="tooltip"
                                                    data-placement="bottom"
                                                    title="Save Changes"
                                                    v-on:click="saveUser(account, index)"
                                                >
                                                    <i class="fas fa-check fa-w-16 fa-fw"></i>
                                                </button>&nbsp;
                                                <button
                                                    class="btn btn-xs btn-secondary"
                                                    data-toggle="tooltip"
                                                    data-placement="bottom"
                                                    title="Cancel Changes"
                                                    v-on:click="cancelEditUser(account, index)"
                                                >
                                                    <i class="fas fa-times fa-w-14 fa-fw"></i>
                                                </button>&nbsp;
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="card-body hidden" id="config-page">
                                <h5 class="card-title">
                                    Game Configuration
                                </h5>
                                <p class="card-text">
                                    Manage how your game connects to Network Next.
                                </p>
                                <form onsubmit="updatePubKey()">
                                    <div class="form-group" id="pubKey">
                                        <label>
                                            Public Key
                                        </label>
                                        <textarea class="form-control" placeholder="Enter your base64-encoded public key" id="pubkey-input" v-model="pubKey">
                                        </textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary btn-sm">
                                        Save game configuration
                                    </button>
                                    <p class="text-muted text-small mt-2"></p>
                                </form>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
        <script src="https://cdn.auth0.com/js/auth0/9.11/auth0.min.js"></script>
        <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
        <script src="https://api.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js"></script>
        <script src="https://cdn.auth0.com/js/auth0-spa-js/1.7/auth0-spa-js.production.js"></script>
        <script src="https://unpkg.com/vue"></script>
        <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
                integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
                crossorigin="anonymous">
        </script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
                integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
                crossorigin="anonymous">
        </script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
                integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
                crossorigin="anonymous">
        </script>
        <script src="https://browser.sentry-cdn.com/5.15.5/bundle.min.js"
            integrity="sha384-wF7Jc4ZlWVxe/L8Ji3hOIBeTgo/HwFuaeEfjGmS3EXAG7Y+7Kjjr91gJpJtr+PAT"
            crossorigin="anonymous">
        </script>
        <script src="./js/uPlot/uPlot.iife.min.js"></script>
        <script src="./js/choices/scripts/choices.js"></script>
        <script src="./js/portal.js"></script>
        <script>
            Sentry.init({ dsn: 'https://e24b8397eac44e1eb7ac090b5492d29e@o382503.ingest.sentry.io/5211452' });
            window.onload = async () => {
                const domain = 'networknext.auth0.com';
                const clientID = 'qR60cjo6FceoTWPYLNZSQmNiP2WIAQr9';

                loginClient = await createAuth0Client({
                    domain: domain,
                    client_id: clientID
                })
                .catch((e) => {
                    Sentry.captureException(e);
                });

                const isAuthenticated =
                    await loginClient.isAuthenticated()
                        .catch((e) => {
                            Sentry.captureException(e);
                        });

                if (isAuthenticated) {
                    startApp();
                    return;
                }
                const query = window.location.search;
                if (query.includes("code=") && query.includes("state=")) {

                    await loginClient.handleRedirectCallback()
                        .catch((e) => {
                            Sentry.captureException(e);
                        });

                    window.history.replaceState({}, document.title, "/");
                    startApp();
                } else {
                    await loginClient.loginWithRedirect({
                        redirect_uri: window.location.origin
                    }).catch((e) => {
                        Sentry.captureException(e);
                    });
                }
            }
        </script>
    </body>
</html>