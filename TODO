DONE

	Now we have to work out how to track magic per-session.

	Where does magic get sent down to the client initially? Upgrade request packet?

	The current magic should get stashed in there.

	Pending session entry only needs magic, not current and pending.

	Stash the magic in there on upgrade, use the entry magic in upgrade response packet.

TODO

	--------------

	Then the client should store the magic.

	Client should use the magic value when receiving packets from the server.

	Client should use the magic value when sending packets to the server.

	--------------


	The pending session should also have the magic stashed in there... just one magic value is enough.

	--------------

	--------------

	Route update should contain current magic on server.

	Client should stash magic in the route update when it changes, and use it right away.

	Session needs pending, current and previous magic.

	When route update ack comes back, server moves move current -> previous, pending -> current in session.

	--------------

	The proxy should also do this, we may need a notification of new magic.

	--------------

	Server should use current and previous magic per-session when reading packets.

	--------------

	Server should use current magic per-session (in proxy), when sending packets to a client.

	--------------

	At this point magic should theoretically be working.

	--------------

	Get the client/server upgrade working and the upgraded direct packets being exchanged between client and server.

	--------------

	Update the func backend 5 so it can handle new SDK5 packet types.

	--------------

	Get various upgraded direct func tests passing.

	--------------






























	========================================================

	--------------

	Work out how to get ping tokens down to the client

	--------------

	Get the client pinging near relays w. ping tokens and getting responses.

	--------------

	Update the reference relay so it can handle the new SDK5 packet types.

	--------------

	Get an actual end-to-end network next route going with SDK5 client/server.

	--------------

	Get the rest of the func tests passing.

	--------------

	=================================================

	--------------

	Move server whois to the backend, it's unreliable when run on the SDK server
	and the iteration time for fixes (new SDK deploy) is just too long.

	--------------

	We need a server flush method to timeout all sessions and flush session updates until acked.

	--------------
